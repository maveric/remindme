"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/permits/route";
exports.ids = ["app/api/permits/route"];
exports.modules = {

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@prisma/client");

/***/ }),

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fpermits%2Froute&page=%2Fapi%2Fpermits%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fpermits%2Froute.ts&appDir=%2Fhome%2Fmav%2Fprojects%2Fpermit-buddy%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Fmav%2Fprojects%2Fpermit-buddy&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fpermits%2Froute&page=%2Fapi%2Fpermits%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fpermits%2Froute.ts&appDir=%2Fhome%2Fmav%2Fprojects%2Fpermit-buddy%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Fmav%2Fprojects%2Fpermit-buddy&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _home_mav_projects_permit_buddy_app_api_permits_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/permits/route.ts */ \"(rsc)/./app/api/permits/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/permits/route\",\n        pathname: \"/api/permits\",\n        filename: \"route\",\n        bundlePath: \"app/api/permits/route\"\n    },\n    resolvedPagePath: \"/home/mav/projects/permit-buddy/app/api/permits/route.ts\",\n    nextConfigOutput,\n    userland: _home_mav_projects_permit_buddy_app_api_permits_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/permits/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZwZXJtaXRzJTJGcm91dGUmcGFnZT0lMkZhcGklMkZwZXJtaXRzJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGcGVybWl0cyUyRnJvdXRlLnRzJmFwcERpcj0lMkZob21lJTJGbWF2JTJGcHJvamVjdHMlMkZwZXJtaXQtYnVkZHklMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRmhvbWUlMkZtYXYlMkZwcm9qZWN0cyUyRnBlcm1pdC1idWRkeSZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDUTtBQUNyRjtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovLy8/M2Y5OCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvaG9tZS9tYXYvcHJvamVjdHMvcGVybWl0LWJ1ZGR5L2FwcC9hcGkvcGVybWl0cy9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvcGVybWl0cy9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3Blcm1pdHNcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3Blcm1pdHMvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvaG9tZS9tYXYvcHJvamVjdHMvcGVybWl0LWJ1ZGR5L2FwcC9hcGkvcGVybWl0cy9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvcGVybWl0cy9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fpermits%2Froute&page=%2Fapi%2Fpermits%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fpermits%2Froute.ts&appDir=%2Fhome%2Fmav%2Fprojects%2Fpermit-buddy%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Fmav%2Fprojects%2Fpermit-buddy&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/permits/route.ts":
/*!**********************************!*\
  !*** ./app/api/permits/route.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _lib_openai__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/openai */ \"(rsc)/./lib/openai.ts\");\n/* harmony import */ var _lib_supabase_server__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/supabase/server */ \"(rsc)/./lib/supabase/server.ts\");\n/* harmony import */ var _lib_supabase_service__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/lib/supabase/service */ \"(rsc)/./lib/supabase/service.ts\");\n/* harmony import */ var _lib_storage__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @/lib/storage */ \"(rsc)/./lib/storage.ts\");\n\n\n\n\n\n\n\nconst runtime = \"nodejs\"; // ensure we have Node APIs like Buffer\nfunction resolveErrorMessage(error, fallback) {\n    if (error instanceof Error && error.message) {\n        return error.message;\n    }\n    return fallback;\n}\nconst DOCUMENT_CATEGORIES = Object.values(_prisma_client__WEBPACK_IMPORTED_MODULE_1__.DocumentCategory);\nconst DOCUMENT_STATUSES = Object.values(_prisma_client__WEBPACK_IMPORTED_MODULE_1__.DocumentStatus);\nfunction normalizeCategory(value) {\n    if (typeof value === \"string\") {\n        const normalized = value.trim().toUpperCase();\n        if (DOCUMENT_CATEGORIES.includes(normalized)) {\n            return normalized;\n        }\n    }\n    return _prisma_client__WEBPACK_IMPORTED_MODULE_1__.DocumentCategory.PERMIT;\n}\nfunction normalizeStatus(value) {\n    if (typeof value === \"string\") {\n        const normalized = value.trim().toUpperCase().replace(/[\\s-]+/g, \"_\");\n        if (DOCUMENT_STATUSES.includes(normalized)) {\n            return normalized;\n        }\n    }\n    return _prisma_client__WEBPACK_IMPORTED_MODULE_1__.DocumentStatus.ACTIVE;\n}\nfunction normalizeDate(value) {\n    if (typeof value !== \"string\") {\n        return \"\";\n    }\n    const trimmed = value.trim();\n    if (!trimmed) {\n        return \"\";\n    }\n    const parsed = new Date(trimmed);\n    if (Number.isNaN(parsed.getTime())) {\n        return \"\";\n    }\n    return parsed.toISOString().slice(0, 10);\n}\nfunction normalizeBoolean(value) {\n    if (typeof value === \"boolean\") {\n        return value;\n    }\n    if (typeof value === \"string\") {\n        const normalized = value.trim().toLowerCase();\n        if (normalized === \"true\" || normalized === \"yes\") {\n            return true;\n        }\n        if (normalized === \"false\" || normalized === \"no\") {\n            return false;\n        }\n    }\n    return false;\n}\nfunction sanitizeAscii(input) {\n    return input.replace(/[^\\x20-\\x7E]+/g, \"\");\n}\nasync function POST(req) {\n    const formData = await req.formData();\n    const file = formData.get(\"file\");\n    if (!file) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"No file uploaded\"\n        }, {\n            status: 400\n        });\n    }\n    const supabase = (0,_lib_supabase_server__WEBPACK_IMPORTED_MODULE_4__.createSupabaseServerClient)();\n    const supabaseService = (0,_lib_supabase_service__WEBPACK_IMPORTED_MODULE_5__.createSupabaseServiceClient)();\n    const { data: { user }, error: authError } = await supabase.auth.getUser();\n    if (authError || !user) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Unauthorized\"\n        }, {\n            status: 401\n        });\n    }\n    // Read file contents\n    const bytes = await file.arrayBuffer();\n    const fileBuffer = Buffer.from(bytes);\n    const base64 = fileBuffer.toString(\"base64\");\n    const dataUrl = `data:${file.type};base64,${base64}`;\n    const currentDate = new Date().toISOString().slice(0, 10);\n    let sourceFileMeta;\n    try {\n        sourceFileMeta = await resolveOrUploadSourceFile(formData, {\n            supabaseStorage: supabaseService,\n            userId: user.id,\n            file,\n            fileBuffer\n        });\n    } catch (error) {\n        const sourceError = error instanceof SourceFileError ? error : null;\n        console.error(\"Source file handling failed\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: sourceError?.message ?? \"Failed to handle source document\"\n        }, {\n            status: sourceError?.status ?? 500\n        });\n    }\n    // ðŸ” Ask the model to extract structured data as JSON\n    // NOTE: The exact shape for image+text messages may differ slightly by model version.\n    // Check OpenAI docs for the latest message format if something errors.\n    const messages = [\n        {\n            role: \"system\",\n            content: \"You are an expert compliance assistant who extracts structured permit data from uploaded documents. Always respond with ONLY a valid JSON object that matches the requested schema.\"\n        },\n        {\n            role: \"user\",\n            content: [\n                {\n                    type: \"text\",\n                    text: `You are helping populate a permit management form. Analyze this document (PDF or image) and infer as much detail as possible.\n\nToday's date is ${currentDate}. Use it as the reference when determining whether a permit is PENDING_ACTIVATION, ACTIVE, PENDING_RENEWAL, or EXPIRED.\n\nReturn JSON with the following keys:\n- title: concise permit or license title. Prefer the document headline or a combination of permit type and location. If a vehicle, include vehicle year, and type. Use an empty string if unknown.\n- permit_number: the permit or license identifier. Empty string if unknown.\n- document_category: choose ONE of [PERMIT, LICENSE, INSPECTION, INSURANCE, REGISTRATION, CERTIFICATION, AGREEMENT, OTHER]. Select the closest match.\n- status: choose ONE of [PENDING_ACTIVATION, ACTIVE, EXPIRED, PENDING_RENEWAL, INACTIVE]. Infer from context (e.g., expired date -> EXPIRED, upcoming renewal -> PENDING_RENEWAL) or default to ACTIVE if unclear.\n- start_date: the issuance or effective date in ISO format YYYY-MM-DD, or an empty string if unclear.\n- end_date: the expiration or renewal date in ISO format YYYY-MM-DD, or an empty string if unclear.\n- auto_renew: boolean true/false. Use true only if the document explicitly states automatic renewal, otherwise false.\n- jurisdiction: the municipality, county, state, or other jurisdiction tied to this permit. Empty string if unknown.\n- issuing_authority: the department, agency, or organization that issued the permit. Empty string if unknown.\n\nRules:\n- Use only ASCII characters in the JSON.\n- Never invent data, but infer when the document makes it obvious.\n- If multiple dates exist, treat the earliest issuance/duty date as start_date and the latest validity/expiration as end_date.\n- Ensure that start_date is always on or before end_date.\n- For end_date: If a specific expiration date is not present, *calculate* it from the start_date and the extracted term_duration. (e.g., start_date \"2025-01-01\" and term_duration \"one year\" -> end_date \"2025-12-31\").\n- For status: You MUST determine the status by following these rules in this specific order:\n  1.  If the start_date is after ${currentDate}, the status is PENDING_ACTIVATION.\n  2.  ELSE, if the end_date is before ${currentDate}, the status is EXPIRED.\n  3.  ELSE, if the start_date is on or before ${currentDate} AND the end_date is on or after ${currentDate}, the status is ACTIVE.\n  4.  ELSE (e.g., if no dates are found), default to ACTIVE.\n- For document_category: Prioritize the document's main title (e.g., a \"Certificate of Liability Insurance\" is INSURANCE).\n- Examples:\n  - Input Text Snippet: \"Certificate of Liability. This policy is effective January 1, 2025. This certificate is not valid for more than one year from the effective date.\"\n  - Output JSON:\n    {\n      \"title\": \"Certificate of Liability\",\n      \"permit_number\": \"\",\n      \"document_category\": \"INSURANCE\",\n      \"status\": \"ACTIVE\",\n      \"start_date\": \"2025-01-01\",\n      \"end_date\": \"2025-12-31\",\n      \"term_duration\": \"one year\",\n      \"auto_renew\": false,\n      \"jurisdiction\": \"\",\n      \"issuing_authority\": \"\"\n    }\n  - Input Text Snippet: \"Current date - 2025-11-17, PENNSYLVANIA FINANCIAL RESPONSIBILITY IDENTIFICATION CARD. Effective Date 01/12/26. NOT VALID MORE THAN SIX MONTHS FROM EFFECTIVE DATE. Vehicle: 2015 FORD.\"\n  - Output JSON:\n    {\n      \"title\": \"2015 FORD Financial Responsibility ID Card\",\n      \"permit_number\": \"\",\n      \"document_category\": \"INSURANCE\",\n      \"status\": \"PENDING_ACTIVATION\",\n      \"start_date\": \"2026-01-12\",\n      \"end_date\": \"2026-07-12\",\n      \"term_duration\": \"SIX MONTHS\",\n      \"auto_renew\": false,\n      \"jurisdiction\": \"PENNSYLVANIA\",\n      \"issuing_authority\": \"USAA\"\n    }\n- Input Text Snippet: \"Charleston Fire Department Operational Permit Sticker. Mobile Food Service Vendor [checked]. Good for 1 yr. from date stamp.. Issued by: Charleston-sc.gov/fm\"\n  - Output JSON:\n    {\n      \"title\": \"Charleston Fire Department Operational Permit Sticker\",\n      \"permit_number\": \"\",\n      \"document_category\": \"PERMIT\",\n      \"status\": \"EXPIRED\",\n      \"start_date\": \"2019-04-07\",\n      \"end_date\": \"2020-04-07\",\n      \"term_duration\": \"1 yr.\",\n      \"auto_renew\": false,\n      \"jurisdiction\": \"Charleston\",\n      \"issuing_authority\": \"Charleston Fire Department\"\n    }\n- Focus on filling every field with the best available information.\n- Respond ONLY with JSON, no commentary.`\n                },\n                {\n                    type: \"image_url\",\n                    image_url: {\n                        url: dataUrl\n                    }\n                }\n            ]\n        }\n    ];\n    const completion = await _lib_openai__WEBPACK_IMPORTED_MODULE_3__.openai.chat.completions.create({\n        model: \"gpt-5.1\",\n        response_format: {\n            type: \"json_object\"\n        },\n        messages\n    });\n    const rawContent = completion.choices[0]?.message?.content;\n    if (!rawContent) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"No content returned from model\"\n        }, {\n            status: 500\n        });\n    }\n    console.log(\"Raw model content:\", rawContent);\n    // Because we requested json_object format, this should be JSON already.\n    let parsed;\n    try {\n        parsed = JSON.parse(rawContent);\n    } catch (error) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: resolveErrorMessage(error, \"Failed to parse JSON from model\"),\n            rawContent\n        }, {\n            status: 500\n        });\n    }\n    if (!parsed || typeof parsed !== \"object\" || Array.isArray(parsed)) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Model response was not an object\",\n            rawContent\n        }, {\n            status: 500\n        });\n    }\n    const titleCandidate = typeof parsed.title === \"string\" ? parsed.title : typeof parsed.permit_title === \"string\" ? parsed.permit_title : typeof parsed.type === \"string\" ? parsed.type : \"\";\n    const permitNumberCandidate = typeof parsed.permit_number === \"string\" ? parsed.permit_number : typeof parsed.number === \"string\" ? parsed.number : typeof parsed.permitNumber === \"string\" ? parsed.permitNumber : \"\";\n    const documentCategory = normalizeCategory(parsed.document_category ?? parsed.category ?? parsed.type);\n    const status = normalizeStatus(parsed.status);\n    const startDate = normalizeDate(parsed.start_date ?? parsed.startDate ?? parsed.issued_date ?? parsed.issue_date);\n    const endDate = normalizeDate(parsed.end_date ?? parsed.endDate ?? parsed.expiration_date ?? parsed.expiry_date);\n    const autoRenew = normalizeBoolean(parsed.auto_renew ?? parsed.autoRenew);\n    const jurisdictionCandidate = typeof parsed.jurisdiction === \"string\" ? parsed.jurisdiction : typeof parsed.jurisdictionName === \"string\" ? parsed.jurisdictionName : \"\";\n    const issuingAuthorityCandidate = typeof parsed.issuing_authority === \"string\" ? parsed.issuing_authority : typeof parsed.issuingAuthority === \"string\" ? parsed.issuingAuthority : \"\";\n    const title = sanitizeAscii(titleCandidate).trim();\n    const permitNumber = sanitizeAscii(permitNumberCandidate).trim();\n    const jurisdiction = sanitizeAscii(jurisdictionCandidate).trim();\n    const issuingAuthority = sanitizeAscii(issuingAuthorityCandidate).trim();\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        title,\n        permitNumber,\n        documentCategory,\n        status,\n        startDate,\n        endDate,\n        autoRenew,\n        jurisdiction,\n        issuingAuthority,\n        rawFields: parsed,\n        sourceFile: sourceFileMeta\n    });\n}\nasync function resolveOrUploadSourceFile(formData, options) {\n    const { supabaseStorage, userId, file, fileBuffer } = options;\n    const existingBucket = formData.get(\"sourceFileBucket\");\n    const existingPath = formData.get(\"sourceFilePath\");\n    const existingContentType = formData.get(\"sourceFileContentType\");\n    const existingName = formData.get(\"sourceFileName\");\n    const existingSize = formData.get(\"sourceFileSize\");\n    if (typeof existingBucket === \"string\" && typeof existingPath === \"string\") {\n        if (existingBucket !== _lib_storage__WEBPACK_IMPORTED_MODULE_6__.PERMIT_FILES_BUCKET || !existingPath.startsWith(`${userId}/`)) {\n            throw new SourceFileError(\"Invalid source file reference\", 400);\n        }\n        const normalizedSize = typeof existingSize === \"string\" ? Number.parseInt(existingSize, 10) : typeof existingSize === \"number\" ? existingSize : undefined;\n        return {\n            bucket: existingBucket,\n            path: existingPath,\n            contentType: typeof existingContentType === \"string\" && existingContentType.trim().length > 0 ? existingContentType : file.type || \"application/octet-stream\",\n            name: typeof existingName === \"string\" && existingName.trim().length > 0 ? existingName : file.name || \"permit-file\",\n            size: Number.isFinite(normalizedSize) ? Number(normalizedSize) : file.size\n        };\n    }\n    const extension = inferExtension(file.name);\n    const objectPath = `${userId}/${new Date().toISOString().slice(0, 10)}/${(0,crypto__WEBPACK_IMPORTED_MODULE_2__.randomUUID)()}${extension}`;\n    const { error: uploadError } = await supabaseStorage.storage.from(_lib_storage__WEBPACK_IMPORTED_MODULE_6__.PERMIT_FILES_BUCKET).upload(objectPath, fileBuffer, {\n        contentType: file.type || \"application/octet-stream\",\n        upsert: false\n    });\n    if (uploadError) {\n        throw new SourceFileError(uploadError.message || \"Failed to store uploaded file\", 500);\n    }\n    return {\n        bucket: _lib_storage__WEBPACK_IMPORTED_MODULE_6__.PERMIT_FILES_BUCKET,\n        path: objectPath,\n        contentType: file.type || \"application/octet-stream\",\n        name: file.name || \"permit-file\",\n        size: file.size\n    };\n}\nfunction inferExtension(fileName) {\n    if (!fileName) {\n        return \"\";\n    }\n    const parts = fileName.split(\".\");\n    if (parts.length < 2) {\n        return \"\";\n    }\n    const ext = parts.pop();\n    if (!ext) {\n        return \"\";\n    }\n    return `.${ext.toLowerCase()}`;\n}\nclass SourceFileError extends Error {\n    constructor(message, status){\n        super(message);\n        this.status = status;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RyxDQUFDO0FBQ2hDO0FBRUEsTUFBTWlDLHdCQUF3QjNEO0lBRzVCeUksWUFBWXhJLE9BQWUsRUFBRWtDLE1BQWMsQ0FBRTtRQUMzQyxLQUFLLENBQUNsQztRQUNOLElBQUksQ0FBQ2tDLE1BQU0sR0FBR0E7SUFDaEI7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL2FwcC9hcGkvcGVybWl0cy9yb3V0ZS50cz9iYTFjIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xuaW1wb3J0IHR5cGUgeyBDaGF0Q29tcGxldGlvbk1lc3NhZ2VQYXJhbSB9IGZyb20gXCJvcGVuYWkvcmVzb3VyY2VzL2NoYXQvY29tcGxldGlvbnNcIjtcbmltcG9ydCB7IERvY3VtZW50Q2F0ZWdvcnksIERvY3VtZW50U3RhdHVzIH0gZnJvbSBcIkBwcmlzbWEvY2xpZW50XCI7XG5pbXBvcnQgeyByYW5kb21VVUlEIH0gZnJvbSBcImNyeXB0b1wiO1xuaW1wb3J0IHsgb3BlbmFpIH0gZnJvbSBcIkAvbGliL29wZW5haVwiO1xuaW1wb3J0IHsgY3JlYXRlU3VwYWJhc2VTZXJ2ZXJDbGllbnQgfSBmcm9tIFwiQC9saWIvc3VwYWJhc2Uvc2VydmVyXCI7XG5pbXBvcnQgeyBjcmVhdGVTdXBhYmFzZVNlcnZpY2VDbGllbnQgfSBmcm9tIFwiQC9saWIvc3VwYWJhc2Uvc2VydmljZVwiO1xuaW1wb3J0IHsgUEVSTUlUX0ZJTEVTX0JVQ0tFVCwgUGVybWl0U291cmNlRmlsZU1ldGEgfSBmcm9tIFwiQC9saWIvc3RvcmFnZVwiO1xuXG5leHBvcnQgY29uc3QgcnVudGltZSA9IFwibm9kZWpzXCI7IC8vIGVuc3VyZSB3ZSBoYXZlIE5vZGUgQVBJcyBsaWtlIEJ1ZmZlclxuXG5mdW5jdGlvbiByZXNvbHZlRXJyb3JNZXNzYWdlKGVycm9yOiB1bmtub3duLCBmYWxsYmFjazogc3RyaW5nKSB7XG4gIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yICYmIGVycm9yLm1lc3NhZ2UpIHtcbiAgICByZXR1cm4gZXJyb3IubWVzc2FnZTtcbiAgfVxuICByZXR1cm4gZmFsbGJhY2s7XG59XG5cbmNvbnN0IERPQ1VNRU5UX0NBVEVHT1JJRVMgPSBPYmplY3QudmFsdWVzKERvY3VtZW50Q2F0ZWdvcnkpO1xuY29uc3QgRE9DVU1FTlRfU1RBVFVTRVMgPSBPYmplY3QudmFsdWVzKERvY3VtZW50U3RhdHVzKTtcblxuZnVuY3Rpb24gbm9ybWFsaXplQ2F0ZWdvcnkodmFsdWU/OiB1bmtub3duKTogRG9jdW1lbnRDYXRlZ29yeSB7XG4gIGlmICh0eXBlb2YgdmFsdWUgPT09IFwic3RyaW5nXCIpIHtcbiAgICBjb25zdCBub3JtYWxpemVkID0gdmFsdWUudHJpbSgpLnRvVXBwZXJDYXNlKCk7XG4gICAgaWYgKERPQ1VNRU5UX0NBVEVHT1JJRVMuaW5jbHVkZXMobm9ybWFsaXplZCBhcyBEb2N1bWVudENhdGVnb3J5KSkge1xuICAgICAgcmV0dXJuIG5vcm1hbGl6ZWQgYXMgRG9jdW1lbnRDYXRlZ29yeTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIERvY3VtZW50Q2F0ZWdvcnkuUEVSTUlUO1xufVxuXG5mdW5jdGlvbiBub3JtYWxpemVTdGF0dXModmFsdWU/OiB1bmtub3duKTogRG9jdW1lbnRTdGF0dXMge1xuICBpZiAodHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiKSB7XG4gICAgY29uc3Qgbm9ybWFsaXplZCA9IHZhbHVlLnRyaW0oKS50b1VwcGVyQ2FzZSgpLnJlcGxhY2UoL1tcXHMtXSsvZywgXCJfXCIpO1xuICAgIGlmIChET0NVTUVOVF9TVEFUVVNFUy5pbmNsdWRlcyhub3JtYWxpemVkIGFzIERvY3VtZW50U3RhdHVzKSkge1xuICAgICAgcmV0dXJuIG5vcm1hbGl6ZWQgYXMgRG9jdW1lbnRTdGF0dXM7XG4gICAgfVxuICB9XG4gIHJldHVybiBEb2N1bWVudFN0YXR1cy5BQ1RJVkU7XG59XG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZURhdGUodmFsdWU/OiB1bmtub3duKTogc3RyaW5nIHtcbiAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gXCJzdHJpbmdcIikge1xuICAgIHJldHVybiBcIlwiO1xuICB9XG4gIGNvbnN0IHRyaW1tZWQgPSB2YWx1ZS50cmltKCk7XG4gIGlmICghdHJpbW1lZCkge1xuICAgIHJldHVybiBcIlwiO1xuICB9XG4gIGNvbnN0IHBhcnNlZCA9IG5ldyBEYXRlKHRyaW1tZWQpO1xuICBpZiAoTnVtYmVyLmlzTmFOKHBhcnNlZC5nZXRUaW1lKCkpKSB7XG4gICAgcmV0dXJuIFwiXCI7XG4gIH1cbiAgcmV0dXJuIHBhcnNlZC50b0lTT1N0cmluZygpLnNsaWNlKDAsIDEwKTtcbn1cblxuZnVuY3Rpb24gbm9ybWFsaXplQm9vbGVhbih2YWx1ZT86IHVua25vd24pOiBib29sZWFuIHtcbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJib29sZWFuXCIpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIikge1xuICAgIGNvbnN0IG5vcm1hbGl6ZWQgPSB2YWx1ZS50cmltKCkudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAobm9ybWFsaXplZCA9PT0gXCJ0cnVlXCIgfHwgbm9ybWFsaXplZCA9PT0gXCJ5ZXNcIikge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmIChub3JtYWxpemVkID09PSBcImZhbHNlXCIgfHwgbm9ybWFsaXplZCA9PT0gXCJub1wiKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gc2FuaXRpemVBc2NpaShpbnB1dDogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIGlucHV0LnJlcGxhY2UoL1teXFx4MjAtXFx4N0VdKy9nLCBcIlwiKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxOiBSZXF1ZXN0KSB7XG4gIGNvbnN0IGZvcm1EYXRhID0gYXdhaXQgcmVxLmZvcm1EYXRhKCk7XG4gIGNvbnN0IGZpbGUgPSBmb3JtRGF0YS5nZXQoXCJmaWxlXCIpIGFzIEZpbGUgfCBudWxsO1xuXG4gIGlmICghZmlsZSkge1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIk5vIGZpbGUgdXBsb2FkZWRcIiB9LCB7IHN0YXR1czogNDAwIH0pO1xuICB9XG5cbiAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVTdXBhYmFzZVNlcnZlckNsaWVudCgpO1xuICBjb25zdCBzdXBhYmFzZVNlcnZpY2UgPSBjcmVhdGVTdXBhYmFzZVNlcnZpY2VDbGllbnQoKTtcbiAgY29uc3Qge1xuICAgIGRhdGE6IHsgdXNlciB9LFxuICAgIGVycm9yOiBhdXRoRXJyb3IsXG4gIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcblxuICBpZiAoYXV0aEVycm9yIHx8ICF1c2VyKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfSwgeyBzdGF0dXM6IDQwMSB9KTtcbiAgfVxuXG4gIC8vIFJlYWQgZmlsZSBjb250ZW50c1xuICBjb25zdCBieXRlcyA9IGF3YWl0IGZpbGUuYXJyYXlCdWZmZXIoKTtcbiAgY29uc3QgZmlsZUJ1ZmZlciA9IEJ1ZmZlci5mcm9tKGJ5dGVzKTtcbiAgY29uc3QgYmFzZTY0ID0gZmlsZUJ1ZmZlci50b1N0cmluZyhcImJhc2U2NFwiKTtcbiAgY29uc3QgZGF0YVVybCA9IGBkYXRhOiR7ZmlsZS50eXBlfTtiYXNlNjQsJHtiYXNlNjR9YDtcbiAgY29uc3QgY3VycmVudERhdGUgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc2xpY2UoMCwgMTApO1xuXG4gIGxldCBzb3VyY2VGaWxlTWV0YTogUGVybWl0U291cmNlRmlsZU1ldGE7XG4gIHRyeSB7XG4gICAgc291cmNlRmlsZU1ldGEgPSBhd2FpdCByZXNvbHZlT3JVcGxvYWRTb3VyY2VGaWxlKGZvcm1EYXRhLCB7XG4gICAgICBzdXBhYmFzZVN0b3JhZ2U6IHN1cGFiYXNlU2VydmljZSxcbiAgICAgIHVzZXJJZDogdXNlci5pZCxcbiAgICAgIGZpbGUsXG4gICAgICBmaWxlQnVmZmVyLFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnN0IHNvdXJjZUVycm9yID0gZXJyb3IgaW5zdGFuY2VvZiBTb3VyY2VGaWxlRXJyb3IgPyBlcnJvciA6IG51bGw7XG4gICAgY29uc29sZS5lcnJvcihcIlNvdXJjZSBmaWxlIGhhbmRsaW5nIGZhaWxlZFwiLCBlcnJvcik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBlcnJvcjogc291cmNlRXJyb3I/Lm1lc3NhZ2UgPz8gXCJGYWlsZWQgdG8gaGFuZGxlIHNvdXJjZSBkb2N1bWVudFwiIH0sXG4gICAgICB7IHN0YXR1czogc291cmNlRXJyb3I/LnN0YXR1cyA/PyA1MDAgfVxuICAgICk7XG4gIH1cblxuICAvLyDwn5SNIEFzayB0aGUgbW9kZWwgdG8gZXh0cmFjdCBzdHJ1Y3R1cmVkIGRhdGEgYXMgSlNPTlxuICAvLyBOT1RFOiBUaGUgZXhhY3Qgc2hhcGUgZm9yIGltYWdlK3RleHQgbWVzc2FnZXMgbWF5IGRpZmZlciBzbGlnaHRseSBieSBtb2RlbCB2ZXJzaW9uLlxuICAvLyBDaGVjayBPcGVuQUkgZG9jcyBmb3IgdGhlIGxhdGVzdCBtZXNzYWdlIGZvcm1hdCBpZiBzb21ldGhpbmcgZXJyb3JzLlxuICBjb25zdCBtZXNzYWdlczogQ2hhdENvbXBsZXRpb25NZXNzYWdlUGFyYW1bXSA9IFtcbiAgICB7XG4gICAgICByb2xlOiBcInN5c3RlbVwiLFxuICAgICAgY29udGVudDpcbiAgICAgICAgXCJZb3UgYXJlIGFuIGV4cGVydCBjb21wbGlhbmNlIGFzc2lzdGFudCB3aG8gZXh0cmFjdHMgc3RydWN0dXJlZCBwZXJtaXQgZGF0YSBmcm9tIHVwbG9hZGVkIGRvY3VtZW50cy4gQWx3YXlzIHJlc3BvbmQgd2l0aCBPTkxZIGEgdmFsaWQgSlNPTiBvYmplY3QgdGhhdCBtYXRjaGVzIHRoZSByZXF1ZXN0ZWQgc2NoZW1hLlwiLFxuICAgIH0sXG4gICAge1xuICAgICAgcm9sZTogXCJ1c2VyXCIsXG4gICAgICBjb250ZW50OiBbXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgICAgICB0ZXh0OiBgWW91IGFyZSBoZWxwaW5nIHBvcHVsYXRlIGEgcGVybWl0IG1hbmFnZW1lbnQgZm9ybS4gQW5hbHl6ZSB0aGlzIGRvY3VtZW50IChQREYgb3IgaW1hZ2UpIGFuZCBpbmZlciBhcyBtdWNoIGRldGFpbCBhcyBwb3NzaWJsZS5cblxuVG9kYXkncyBkYXRlIGlzICR7Y3VycmVudERhdGV9LiBVc2UgaXQgYXMgdGhlIHJlZmVyZW5jZSB3aGVuIGRldGVybWluaW5nIHdoZXRoZXIgYSBwZXJtaXQgaXMgUEVORElOR19BQ1RJVkFUSU9OLCBBQ1RJVkUsIFBFTkRJTkdfUkVORVdBTCwgb3IgRVhQSVJFRC5cblxuUmV0dXJuIEpTT04gd2l0aCB0aGUgZm9sbG93aW5nIGtleXM6XG4tIHRpdGxlOiBjb25jaXNlIHBlcm1pdCBvciBsaWNlbnNlIHRpdGxlLiBQcmVmZXIgdGhlIGRvY3VtZW50IGhlYWRsaW5lIG9yIGEgY29tYmluYXRpb24gb2YgcGVybWl0IHR5cGUgYW5kIGxvY2F0aW9uLiBJZiBhIHZlaGljbGUsIGluY2x1ZGUgdmVoaWNsZSB5ZWFyLCBhbmQgdHlwZS4gVXNlIGFuIGVtcHR5IHN0cmluZyBpZiB1bmtub3duLlxuLSBwZXJtaXRfbnVtYmVyOiB0aGUgcGVybWl0IG9yIGxpY2Vuc2UgaWRlbnRpZmllci4gRW1wdHkgc3RyaW5nIGlmIHVua25vd24uXG4tIGRvY3VtZW50X2NhdGVnb3J5OiBjaG9vc2UgT05FIG9mIFtQRVJNSVQsIExJQ0VOU0UsIElOU1BFQ1RJT04sIElOU1VSQU5DRSwgUkVHSVNUUkFUSU9OLCBDRVJUSUZJQ0FUSU9OLCBBR1JFRU1FTlQsIE9USEVSXS4gU2VsZWN0IHRoZSBjbG9zZXN0IG1hdGNoLlxuLSBzdGF0dXM6IGNob29zZSBPTkUgb2YgW1BFTkRJTkdfQUNUSVZBVElPTiwgQUNUSVZFLCBFWFBJUkVELCBQRU5ESU5HX1JFTkVXQUwsIElOQUNUSVZFXS4gSW5mZXIgZnJvbSBjb250ZXh0IChlLmcuLCBleHBpcmVkIGRhdGUgLT4gRVhQSVJFRCwgdXBjb21pbmcgcmVuZXdhbCAtPiBQRU5ESU5HX1JFTkVXQUwpIG9yIGRlZmF1bHQgdG8gQUNUSVZFIGlmIHVuY2xlYXIuXG4tIHN0YXJ0X2RhdGU6IHRoZSBpc3N1YW5jZSBvciBlZmZlY3RpdmUgZGF0ZSBpbiBJU08gZm9ybWF0IFlZWVktTU0tREQsIG9yIGFuIGVtcHR5IHN0cmluZyBpZiB1bmNsZWFyLlxuLSBlbmRfZGF0ZTogdGhlIGV4cGlyYXRpb24gb3IgcmVuZXdhbCBkYXRlIGluIElTTyBmb3JtYXQgWVlZWS1NTS1ERCwgb3IgYW4gZW1wdHkgc3RyaW5nIGlmIHVuY2xlYXIuXG4tIGF1dG9fcmVuZXc6IGJvb2xlYW4gdHJ1ZS9mYWxzZS4gVXNlIHRydWUgb25seSBpZiB0aGUgZG9jdW1lbnQgZXhwbGljaXRseSBzdGF0ZXMgYXV0b21hdGljIHJlbmV3YWwsIG90aGVyd2lzZSBmYWxzZS5cbi0ganVyaXNkaWN0aW9uOiB0aGUgbXVuaWNpcGFsaXR5LCBjb3VudHksIHN0YXRlLCBvciBvdGhlciBqdXJpc2RpY3Rpb24gdGllZCB0byB0aGlzIHBlcm1pdC4gRW1wdHkgc3RyaW5nIGlmIHVua25vd24uXG4tIGlzc3VpbmdfYXV0aG9yaXR5OiB0aGUgZGVwYXJ0bWVudCwgYWdlbmN5LCBvciBvcmdhbml6YXRpb24gdGhhdCBpc3N1ZWQgdGhlIHBlcm1pdC4gRW1wdHkgc3RyaW5nIGlmIHVua25vd24uXG5cblJ1bGVzOlxuLSBVc2Ugb25seSBBU0NJSSBjaGFyYWN0ZXJzIGluIHRoZSBKU09OLlxuLSBOZXZlciBpbnZlbnQgZGF0YSwgYnV0IGluZmVyIHdoZW4gdGhlIGRvY3VtZW50IG1ha2VzIGl0IG9idmlvdXMuXG4tIElmIG11bHRpcGxlIGRhdGVzIGV4aXN0LCB0cmVhdCB0aGUgZWFybGllc3QgaXNzdWFuY2UvZHV0eSBkYXRlIGFzIHN0YXJ0X2RhdGUgYW5kIHRoZSBsYXRlc3QgdmFsaWRpdHkvZXhwaXJhdGlvbiBhcyBlbmRfZGF0ZS5cbi0gRW5zdXJlIHRoYXQgc3RhcnRfZGF0ZSBpcyBhbHdheXMgb24gb3IgYmVmb3JlIGVuZF9kYXRlLlxuLSBGb3IgZW5kX2RhdGU6IElmIGEgc3BlY2lmaWMgZXhwaXJhdGlvbiBkYXRlIGlzIG5vdCBwcmVzZW50LCAqY2FsY3VsYXRlKiBpdCBmcm9tIHRoZSBzdGFydF9kYXRlIGFuZCB0aGUgZXh0cmFjdGVkIHRlcm1fZHVyYXRpb24uIChlLmcuLCBzdGFydF9kYXRlIFwiMjAyNS0wMS0wMVwiIGFuZCB0ZXJtX2R1cmF0aW9uIFwib25lIHllYXJcIiAtPiBlbmRfZGF0ZSBcIjIwMjUtMTItMzFcIikuXG4tIEZvciBzdGF0dXM6IFlvdSBNVVNUIGRldGVybWluZSB0aGUgc3RhdHVzIGJ5IGZvbGxvd2luZyB0aGVzZSBydWxlcyBpbiB0aGlzIHNwZWNpZmljIG9yZGVyOlxuICAxLiAgSWYgdGhlIHN0YXJ0X2RhdGUgaXMgYWZ0ZXIgJHtjdXJyZW50RGF0ZX0sIHRoZSBzdGF0dXMgaXMgUEVORElOR19BQ1RJVkFUSU9OLlxuICAyLiAgRUxTRSwgaWYgdGhlIGVuZF9kYXRlIGlzIGJlZm9yZSAke2N1cnJlbnREYXRlfSwgdGhlIHN0YXR1cyBpcyBFWFBJUkVELlxuICAzLiAgRUxTRSwgaWYgdGhlIHN0YXJ0X2RhdGUgaXMgb24gb3IgYmVmb3JlICR7Y3VycmVudERhdGV9IEFORCB0aGUgZW5kX2RhdGUgaXMgb24gb3IgYWZ0ZXIgJHtjdXJyZW50RGF0ZX0sIHRoZSBzdGF0dXMgaXMgQUNUSVZFLlxuICA0LiAgRUxTRSAoZS5nLiwgaWYgbm8gZGF0ZXMgYXJlIGZvdW5kKSwgZGVmYXVsdCB0byBBQ1RJVkUuXG4tIEZvciBkb2N1bWVudF9jYXRlZ29yeTogUHJpb3JpdGl6ZSB0aGUgZG9jdW1lbnQncyBtYWluIHRpdGxlIChlLmcuLCBhIFwiQ2VydGlmaWNhdGUgb2YgTGlhYmlsaXR5IEluc3VyYW5jZVwiIGlzIElOU1VSQU5DRSkuXG4tIEV4YW1wbGVzOlxuICAtIElucHV0IFRleHQgU25pcHBldDogXCJDZXJ0aWZpY2F0ZSBvZiBMaWFiaWxpdHkuIFRoaXMgcG9saWN5IGlzIGVmZmVjdGl2ZSBKYW51YXJ5IDEsIDIwMjUuIFRoaXMgY2VydGlmaWNhdGUgaXMgbm90IHZhbGlkIGZvciBtb3JlIHRoYW4gb25lIHllYXIgZnJvbSB0aGUgZWZmZWN0aXZlIGRhdGUuXCJcbiAgLSBPdXRwdXQgSlNPTjpcbiAgICB7XG4gICAgICBcInRpdGxlXCI6IFwiQ2VydGlmaWNhdGUgb2YgTGlhYmlsaXR5XCIsXG4gICAgICBcInBlcm1pdF9udW1iZXJcIjogXCJcIixcbiAgICAgIFwiZG9jdW1lbnRfY2F0ZWdvcnlcIjogXCJJTlNVUkFOQ0VcIixcbiAgICAgIFwic3RhdHVzXCI6IFwiQUNUSVZFXCIsXG4gICAgICBcInN0YXJ0X2RhdGVcIjogXCIyMDI1LTAxLTAxXCIsXG4gICAgICBcImVuZF9kYXRlXCI6IFwiMjAyNS0xMi0zMVwiLFxuICAgICAgXCJ0ZXJtX2R1cmF0aW9uXCI6IFwib25lIHllYXJcIixcbiAgICAgIFwiYXV0b19yZW5ld1wiOiBmYWxzZSxcbiAgICAgIFwianVyaXNkaWN0aW9uXCI6IFwiXCIsXG4gICAgICBcImlzc3VpbmdfYXV0aG9yaXR5XCI6IFwiXCJcbiAgICB9XG4gIC0gSW5wdXQgVGV4dCBTbmlwcGV0OiBcIkN1cnJlbnQgZGF0ZSAtIDIwMjUtMTEtMTcsIFBFTk5TWUxWQU5JQSBGSU5BTkNJQUwgUkVTUE9OU0lCSUxJVFkgSURFTlRJRklDQVRJT04gQ0FSRC4gRWZmZWN0aXZlIERhdGUgMDEvMTIvMjYuIE5PVCBWQUxJRCBNT1JFIFRIQU4gU0lYIE1PTlRIUyBGUk9NIEVGRkVDVElWRSBEQVRFLiBWZWhpY2xlOiAyMDE1IEZPUkQuXCJcbiAgLSBPdXRwdXQgSlNPTjpcbiAgICB7XG4gICAgICBcInRpdGxlXCI6IFwiMjAxNSBGT1JEIEZpbmFuY2lhbCBSZXNwb25zaWJpbGl0eSBJRCBDYXJkXCIsXG4gICAgICBcInBlcm1pdF9udW1iZXJcIjogXCJcIixcbiAgICAgIFwiZG9jdW1lbnRfY2F0ZWdvcnlcIjogXCJJTlNVUkFOQ0VcIixcbiAgICAgIFwic3RhdHVzXCI6IFwiUEVORElOR19BQ1RJVkFUSU9OXCIsXG4gICAgICBcInN0YXJ0X2RhdGVcIjogXCIyMDI2LTAxLTEyXCIsXG4gICAgICBcImVuZF9kYXRlXCI6IFwiMjAyNi0wNy0xMlwiLFxuICAgICAgXCJ0ZXJtX2R1cmF0aW9uXCI6IFwiU0lYIE1PTlRIU1wiLFxuICAgICAgXCJhdXRvX3JlbmV3XCI6IGZhbHNlLFxuICAgICAgXCJqdXJpc2RpY3Rpb25cIjogXCJQRU5OU1lMVkFOSUFcIixcbiAgICAgIFwiaXNzdWluZ19hdXRob3JpdHlcIjogXCJVU0FBXCJcbiAgICB9XG4tIElucHV0IFRleHQgU25pcHBldDogXCJDaGFybGVzdG9uIEZpcmUgRGVwYXJ0bWVudCBPcGVyYXRpb25hbCBQZXJtaXQgU3RpY2tlci4gTW9iaWxlIEZvb2QgU2VydmljZSBWZW5kb3IgW2NoZWNrZWRdLiBHb29kIGZvciAxIHlyLiBmcm9tIGRhdGUgc3RhbXAuLiBJc3N1ZWQgYnk6IENoYXJsZXN0b24tc2MuZ292L2ZtXCJcbiAgLSBPdXRwdXQgSlNPTjpcbiAgICB7XG4gICAgICBcInRpdGxlXCI6IFwiQ2hhcmxlc3RvbiBGaXJlIERlcGFydG1lbnQgT3BlcmF0aW9uYWwgUGVybWl0IFN0aWNrZXJcIixcbiAgICAgIFwicGVybWl0X251bWJlclwiOiBcIlwiLFxuICAgICAgXCJkb2N1bWVudF9jYXRlZ29yeVwiOiBcIlBFUk1JVFwiLFxuICAgICAgXCJzdGF0dXNcIjogXCJFWFBJUkVEXCIsXG4gICAgICBcInN0YXJ0X2RhdGVcIjogXCIyMDE5LTA0LTA3XCIsXG4gICAgICBcImVuZF9kYXRlXCI6IFwiMjAyMC0wNC0wN1wiLFxuICAgICAgXCJ0ZXJtX2R1cmF0aW9uXCI6IFwiMSB5ci5cIixcbiAgICAgIFwiYXV0b19yZW5ld1wiOiBmYWxzZSxcbiAgICAgIFwianVyaXNkaWN0aW9uXCI6IFwiQ2hhcmxlc3RvblwiLFxuICAgICAgXCJpc3N1aW5nX2F1dGhvcml0eVwiOiBcIkNoYXJsZXN0b24gRmlyZSBEZXBhcnRtZW50XCJcbiAgICB9XG4tIEZvY3VzIG9uIGZpbGxpbmcgZXZlcnkgZmllbGQgd2l0aCB0aGUgYmVzdCBhdmFpbGFibGUgaW5mb3JtYXRpb24uXG4tIFJlc3BvbmQgT05MWSB3aXRoIEpTT04sIG5vIGNvbW1lbnRhcnkuYCxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHR5cGU6IFwiaW1hZ2VfdXJsXCIsXG4gICAgICAgICAgaW1hZ2VfdXJsOiB7XG4gICAgICAgICAgICB1cmw6IGRhdGFVcmwsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSxcbiAgXTtcblxuICBjb25zdCBjb21wbGV0aW9uID0gYXdhaXQgb3BlbmFpLmNoYXQuY29tcGxldGlvbnMuY3JlYXRlKHtcbiAgICBtb2RlbDogXCJncHQtNS4xXCIsIC8vIG9yIGFub3RoZXIgdmlzaW9uLWNhcGFibGUgbW9kZWxcbiAgICByZXNwb25zZV9mb3JtYXQ6IHsgdHlwZTogXCJqc29uX29iamVjdFwiIH0sIC8vIGFzayBmb3IgcHJvcGVyIEpTT05cbiAgICBtZXNzYWdlcyxcbiAgfSk7XG5cbiAgY29uc3QgcmF3Q29udGVudCA9IGNvbXBsZXRpb24uY2hvaWNlc1swXT8ubWVzc2FnZT8uY29udGVudDtcbiAgaWYgKCFyYXdDb250ZW50KSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBlcnJvcjogXCJObyBjb250ZW50IHJldHVybmVkIGZyb20gbW9kZWxcIiB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxuICBjb25zb2xlLmxvZyhcIlJhdyBtb2RlbCBjb250ZW50OlwiLCByYXdDb250ZW50KTtcbiAgLy8gQmVjYXVzZSB3ZSByZXF1ZXN0ZWQganNvbl9vYmplY3QgZm9ybWF0LCB0aGlzIHNob3VsZCBiZSBKU09OIGFscmVhZHkuXG4gIGxldCBwYXJzZWQ6IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuXG4gIHRyeSB7XG4gICAgcGFyc2VkID0gSlNPTi5wYXJzZShyYXdDb250ZW50KTtcbiAgfSBjYXRjaCAoZXJyb3I6IHVua25vd24pIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7XG4gICAgICAgIGVycm9yOiByZXNvbHZlRXJyb3JNZXNzYWdlKGVycm9yLCBcIkZhaWxlZCB0byBwYXJzZSBKU09OIGZyb20gbW9kZWxcIiksXG4gICAgICAgIHJhd0NvbnRlbnQsXG4gICAgICB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxuXG4gIGlmICghcGFyc2VkIHx8IHR5cGVvZiBwYXJzZWQgIT09IFwib2JqZWN0XCIgfHwgQXJyYXkuaXNBcnJheShwYXJzZWQpKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBlcnJvcjogXCJNb2RlbCByZXNwb25zZSB3YXMgbm90IGFuIG9iamVjdFwiLCByYXdDb250ZW50IH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApO1xuICB9XG5cbiAgY29uc3QgdGl0bGVDYW5kaWRhdGUgPVxuICAgIHR5cGVvZiBwYXJzZWQudGl0bGUgPT09IFwic3RyaW5nXCJcbiAgICAgID8gcGFyc2VkLnRpdGxlXG4gICAgICA6IHR5cGVvZiAocGFyc2VkIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5wZXJtaXRfdGl0bGUgPT09IFwic3RyaW5nXCJcbiAgICAgID8gKChwYXJzZWQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLnBlcm1pdF90aXRsZSBhcyBzdHJpbmcpXG4gICAgICA6IHR5cGVvZiAocGFyc2VkIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS50eXBlID09PSBcInN0cmluZ1wiXG4gICAgICA/ICgocGFyc2VkIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS50eXBlIGFzIHN0cmluZylcbiAgICAgIDogXCJcIjtcblxuICBjb25zdCBwZXJtaXROdW1iZXJDYW5kaWRhdGUgPVxuICAgIHR5cGVvZiBwYXJzZWQucGVybWl0X251bWJlciA9PT0gXCJzdHJpbmdcIlxuICAgICAgPyBwYXJzZWQucGVybWl0X251bWJlclxuICAgICAgOiB0eXBlb2YgKHBhcnNlZCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikubnVtYmVyID09PSBcInN0cmluZ1wiXG4gICAgICA/ICgocGFyc2VkIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5udW1iZXIgYXMgc3RyaW5nKVxuICAgICAgOiB0eXBlb2YgKHBhcnNlZCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikucGVybWl0TnVtYmVyID09PSBcInN0cmluZ1wiXG4gICAgICA/ICgocGFyc2VkIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5wZXJtaXROdW1iZXIgYXMgc3RyaW5nKVxuICAgICAgOiBcIlwiO1xuXG4gIGNvbnN0IGRvY3VtZW50Q2F0ZWdvcnkgPSBub3JtYWxpemVDYXRlZ29yeShcbiAgICAocGFyc2VkIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5kb2N1bWVudF9jYXRlZ29yeSA/P1xuICAgICAgKHBhcnNlZCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikuY2F0ZWdvcnkgPz9cbiAgICAgIChwYXJzZWQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLnR5cGVcbiAgKTtcblxuICBjb25zdCBzdGF0dXMgPSBub3JtYWxpemVTdGF0dXMoKHBhcnNlZCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikuc3RhdHVzKTtcbiAgY29uc3Qgc3RhcnREYXRlID0gbm9ybWFsaXplRGF0ZShcbiAgICAocGFyc2VkIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5zdGFydF9kYXRlID8/XG4gICAgICAocGFyc2VkIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5zdGFydERhdGUgPz9cbiAgICAgIChwYXJzZWQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLmlzc3VlZF9kYXRlID8/XG4gICAgICAocGFyc2VkIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5pc3N1ZV9kYXRlXG4gICk7XG4gIGNvbnN0IGVuZERhdGUgPSBub3JtYWxpemVEYXRlKFxuICAgIChwYXJzZWQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLmVuZF9kYXRlID8/XG4gICAgICAocGFyc2VkIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5lbmREYXRlID8/XG4gICAgICAocGFyc2VkIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5leHBpcmF0aW9uX2RhdGUgPz9cbiAgICAgIChwYXJzZWQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLmV4cGlyeV9kYXRlXG4gICk7XG4gIGNvbnN0IGF1dG9SZW5ldyA9IG5vcm1hbGl6ZUJvb2xlYW4oXG4gICAgKHBhcnNlZCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikuYXV0b19yZW5ldyA/P1xuICAgICAgKHBhcnNlZCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikuYXV0b1JlbmV3XG4gICk7XG4gIGNvbnN0IGp1cmlzZGljdGlvbkNhbmRpZGF0ZSA9XG4gICAgdHlwZW9mIChwYXJzZWQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLmp1cmlzZGljdGlvbiA9PT0gXCJzdHJpbmdcIlxuICAgICAgPyAoKHBhcnNlZCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikuanVyaXNkaWN0aW9uIGFzIHN0cmluZylcbiAgICAgIDogdHlwZW9mIChwYXJzZWQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLmp1cmlzZGljdGlvbk5hbWUgPT09IFwic3RyaW5nXCJcbiAgICAgID8gKChwYXJzZWQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLmp1cmlzZGljdGlvbk5hbWUgYXMgc3RyaW5nKVxuICAgICAgOiBcIlwiO1xuICBjb25zdCBpc3N1aW5nQXV0aG9yaXR5Q2FuZGlkYXRlID1cbiAgICB0eXBlb2YgKHBhcnNlZCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikuaXNzdWluZ19hdXRob3JpdHkgPT09IFwic3RyaW5nXCJcbiAgICAgID8gKChwYXJzZWQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLmlzc3VpbmdfYXV0aG9yaXR5IGFzIHN0cmluZylcbiAgICAgIDogdHlwZW9mIChwYXJzZWQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLmlzc3VpbmdBdXRob3JpdHkgPT09IFwic3RyaW5nXCJcbiAgICAgID8gKChwYXJzZWQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLmlzc3VpbmdBdXRob3JpdHkgYXMgc3RyaW5nKVxuICAgICAgOiBcIlwiO1xuXG4gIGNvbnN0IHRpdGxlID0gc2FuaXRpemVBc2NpaSh0aXRsZUNhbmRpZGF0ZSkudHJpbSgpO1xuICBjb25zdCBwZXJtaXROdW1iZXIgPSBzYW5pdGl6ZUFzY2lpKHBlcm1pdE51bWJlckNhbmRpZGF0ZSkudHJpbSgpO1xuICBjb25zdCBqdXJpc2RpY3Rpb24gPSBzYW5pdGl6ZUFzY2lpKGp1cmlzZGljdGlvbkNhbmRpZGF0ZSkudHJpbSgpO1xuICBjb25zdCBpc3N1aW5nQXV0aG9yaXR5ID0gc2FuaXRpemVBc2NpaShpc3N1aW5nQXV0aG9yaXR5Q2FuZGlkYXRlKS50cmltKCk7XG5cbiAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICB0aXRsZSxcbiAgICBwZXJtaXROdW1iZXIsXG4gICAgZG9jdW1lbnRDYXRlZ29yeSxcbiAgICBzdGF0dXMsXG4gICAgc3RhcnREYXRlLFxuICAgIGVuZERhdGUsXG4gICAgYXV0b1JlbmV3LFxuICAgIGp1cmlzZGljdGlvbixcbiAgICBpc3N1aW5nQXV0aG9yaXR5LFxuICAgIHJhd0ZpZWxkczogcGFyc2VkLFxuICAgIHNvdXJjZUZpbGU6IHNvdXJjZUZpbGVNZXRhLFxuICB9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gcmVzb2x2ZU9yVXBsb2FkU291cmNlRmlsZShcbiAgZm9ybURhdGE6IEZvcm1EYXRhLFxuICBvcHRpb25zOiB7XG4gICAgc3VwYWJhc2VTdG9yYWdlOiBSZXR1cm5UeXBlPHR5cGVvZiBjcmVhdGVTdXBhYmFzZVNlcnZpY2VDbGllbnQ+O1xuICAgIHVzZXJJZDogc3RyaW5nO1xuICAgIGZpbGU6IEZpbGU7XG4gICAgZmlsZUJ1ZmZlcjogQnVmZmVyO1xuICB9XG4pOiBQcm9taXNlPFBlcm1pdFNvdXJjZUZpbGVNZXRhPiB7XG4gIGNvbnN0IHsgc3VwYWJhc2VTdG9yYWdlLCB1c2VySWQsIGZpbGUsIGZpbGVCdWZmZXIgfSA9IG9wdGlvbnM7XG5cbiAgY29uc3QgZXhpc3RpbmdCdWNrZXQgPSBmb3JtRGF0YS5nZXQoXCJzb3VyY2VGaWxlQnVja2V0XCIpO1xuICBjb25zdCBleGlzdGluZ1BhdGggPSBmb3JtRGF0YS5nZXQoXCJzb3VyY2VGaWxlUGF0aFwiKTtcbiAgY29uc3QgZXhpc3RpbmdDb250ZW50VHlwZSA9IGZvcm1EYXRhLmdldChcInNvdXJjZUZpbGVDb250ZW50VHlwZVwiKTtcbiAgY29uc3QgZXhpc3RpbmdOYW1lID0gZm9ybURhdGEuZ2V0KFwic291cmNlRmlsZU5hbWVcIik7XG4gIGNvbnN0IGV4aXN0aW5nU2l6ZSA9IGZvcm1EYXRhLmdldChcInNvdXJjZUZpbGVTaXplXCIpO1xuXG4gIGlmICh0eXBlb2YgZXhpc3RpbmdCdWNrZXQgPT09IFwic3RyaW5nXCIgJiYgdHlwZW9mIGV4aXN0aW5nUGF0aCA9PT0gXCJzdHJpbmdcIikge1xuICAgIGlmIChleGlzdGluZ0J1Y2tldCAhPT0gUEVSTUlUX0ZJTEVTX0JVQ0tFVCB8fCAhZXhpc3RpbmdQYXRoLnN0YXJ0c1dpdGgoYCR7dXNlcklkfS9gKSkge1xuICAgICAgdGhyb3cgbmV3IFNvdXJjZUZpbGVFcnJvcihcIkludmFsaWQgc291cmNlIGZpbGUgcmVmZXJlbmNlXCIsIDQwMCk7XG4gICAgfVxuXG4gICAgY29uc3Qgbm9ybWFsaXplZFNpemUgPVxuICAgICAgdHlwZW9mIGV4aXN0aW5nU2l6ZSA9PT0gXCJzdHJpbmdcIlxuICAgICAgICA/IE51bWJlci5wYXJzZUludChleGlzdGluZ1NpemUsIDEwKVxuICAgICAgICA6IHR5cGVvZiBleGlzdGluZ1NpemUgPT09IFwibnVtYmVyXCJcbiAgICAgICAgPyBleGlzdGluZ1NpemVcbiAgICAgICAgOiB1bmRlZmluZWQ7XG5cbiAgICByZXR1cm4ge1xuICAgICAgYnVja2V0OiBleGlzdGluZ0J1Y2tldCxcbiAgICAgIHBhdGg6IGV4aXN0aW5nUGF0aCxcbiAgICAgIGNvbnRlbnRUeXBlOlxuICAgICAgICB0eXBlb2YgZXhpc3RpbmdDb250ZW50VHlwZSA9PT0gXCJzdHJpbmdcIiAmJiBleGlzdGluZ0NvbnRlbnRUeXBlLnRyaW0oKS5sZW5ndGggPiAwXG4gICAgICAgICAgPyBleGlzdGluZ0NvbnRlbnRUeXBlXG4gICAgICAgICAgOiBmaWxlLnR5cGUgfHwgXCJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW1cIixcbiAgICAgIG5hbWU6XG4gICAgICAgIHR5cGVvZiBleGlzdGluZ05hbWUgPT09IFwic3RyaW5nXCIgJiYgZXhpc3RpbmdOYW1lLnRyaW0oKS5sZW5ndGggPiAwXG4gICAgICAgICAgPyBleGlzdGluZ05hbWVcbiAgICAgICAgICA6IGZpbGUubmFtZSB8fCBcInBlcm1pdC1maWxlXCIsXG4gICAgICBzaXplOiBOdW1iZXIuaXNGaW5pdGUobm9ybWFsaXplZFNpemUpID8gTnVtYmVyKG5vcm1hbGl6ZWRTaXplKSA6IGZpbGUuc2l6ZSxcbiAgICB9O1xuICB9XG5cbiAgY29uc3QgZXh0ZW5zaW9uID0gaW5mZXJFeHRlbnNpb24oZmlsZS5uYW1lKTtcbiAgY29uc3Qgb2JqZWN0UGF0aCA9IGAke3VzZXJJZH0vJHtuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc2xpY2UoMCwgMTApfS8ke3JhbmRvbVVVSUQoKX0ke2V4dGVuc2lvbn1gO1xuICBjb25zdCB7IGVycm9yOiB1cGxvYWRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VTdG9yYWdlLnN0b3JhZ2VcbiAgICAuZnJvbShQRVJNSVRfRklMRVNfQlVDS0VUKVxuICAgIC51cGxvYWQob2JqZWN0UGF0aCwgZmlsZUJ1ZmZlciwge1xuICAgICAgY29udGVudFR5cGU6IGZpbGUudHlwZSB8fCBcImFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbVwiLFxuICAgICAgdXBzZXJ0OiBmYWxzZSxcbiAgICB9KTtcblxuICBpZiAodXBsb2FkRXJyb3IpIHtcbiAgICB0aHJvdyBuZXcgU291cmNlRmlsZUVycm9yKHVwbG9hZEVycm9yLm1lc3NhZ2UgfHwgXCJGYWlsZWQgdG8gc3RvcmUgdXBsb2FkZWQgZmlsZVwiLCA1MDApO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBidWNrZXQ6IFBFUk1JVF9GSUxFU19CVUNLRVQsXG4gICAgcGF0aDogb2JqZWN0UGF0aCxcbiAgICBjb250ZW50VHlwZTogZmlsZS50eXBlIHx8IFwiYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtXCIsXG4gICAgbmFtZTogZmlsZS5uYW1lIHx8IFwicGVybWl0LWZpbGVcIixcbiAgICBzaXplOiBmaWxlLnNpemUsXG4gIH07XG59XG5cbmZ1bmN0aW9uIGluZmVyRXh0ZW5zaW9uKGZpbGVOYW1lPzogc3RyaW5nIHwgbnVsbCkge1xuICBpZiAoIWZpbGVOYW1lKSB7XG4gICAgcmV0dXJuIFwiXCI7XG4gIH1cbiAgY29uc3QgcGFydHMgPSBmaWxlTmFtZS5zcGxpdChcIi5cIik7XG4gIGlmIChwYXJ0cy5sZW5ndGggPCAyKSB7XG4gICAgcmV0dXJuIFwiXCI7XG4gIH1cbiAgY29uc3QgZXh0ID0gcGFydHMucG9wKCk7XG4gIGlmICghZXh0KSB7XG4gICAgcmV0dXJuIFwiXCI7XG4gIH1cbiAgcmV0dXJuIGAuJHtleHQudG9Mb3dlckNhc2UoKX1gO1xufVxuXG5jbGFzcyBTb3VyY2VGaWxlRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIHN0YXR1czogbnVtYmVyO1xuXG4gIGNvbnN0cnVjdG9yKG1lc3NhZ2U6IHN0cmluZywgc3RhdHVzOiBudW1iZXIpIHtcbiAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB0aGlzLnN0YXR1cyA9IHN0YXR1cztcbiAgfVxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsIkRvY3VtZW50Q2F0ZWdvcnkiLCJEb2N1bWVudFN0YXR1cyIsInJhbmRvbVVVSUQiLCJvcGVuYWkiLCJjcmVhdGVTdXBhYmFzZVNlcnZlckNsaWVudCIsImNyZWF0ZVN1cGFiYXNlU2VydmljZUNsaWVudCIsIlBFUk1JVF9GSUxFU19CVUNLRVQiLCJydW50aW1lIiwicmVzb2x2ZUVycm9yTWVzc2FnZSIsImVycm9yIiwiZmFsbGJhY2siLCJFcnJvciIsIm1lc3NhZ2UiLCJET0NVTUVOVF9DQVRFR09SSUVTIiwiT2JqZWN0IiwidmFsdWVzIiwiRE9DVU1FTlRfU1RBVFVTRVMiLCJub3JtYWxpemVDYXRlZ29yeSIsInZhbHVlIiwibm9ybWFsaXplZCIsInRyaW0iLCJ0b1VwcGVyQ2FzZSIsImluY2x1ZGVzIiwiUEVSTUlUIiwibm9ybWFsaXplU3RhdHVzIiwicmVwbGFjZSIsIkFDVElWRSIsIm5vcm1hbGl6ZURhdGUiLCJ0cmltbWVkIiwicGFyc2VkIiwiRGF0ZSIsIk51bWJlciIsImlzTmFOIiwiZ2V0VGltZSIsInRvSVNPU3RyaW5nIiwic2xpY2UiLCJub3JtYWxpemVCb29sZWFuIiwidG9Mb3dlckNhc2UiLCJzYW5pdGl6ZUFzY2lpIiwiaW5wdXQiLCJQT1NUIiwicmVxIiwiZm9ybURhdGEiLCJmaWxlIiwiZ2V0IiwianNvbiIsInN0YXR1cyIsInN1cGFiYXNlIiwic3VwYWJhc2VTZXJ2aWNlIiwiZGF0YSIsInVzZXIiLCJhdXRoRXJyb3IiLCJhdXRoIiwiZ2V0VXNlciIsImJ5dGVzIiwiYXJyYXlCdWZmZXIiLCJmaWxlQnVmZmVyIiwiQnVmZmVyIiwiZnJvbSIsImJhc2U2NCIsInRvU3RyaW5nIiwiZGF0YVVybCIsInR5cGUiLCJjdXJyZW50RGF0ZSIsInNvdXJjZUZpbGVNZXRhIiwicmVzb2x2ZU9yVXBsb2FkU291cmNlRmlsZSIsInN1cGFiYXNlU3RvcmFnZSIsInVzZXJJZCIsImlkIiwic291cmNlRXJyb3IiLCJTb3VyY2VGaWxlRXJyb3IiLCJjb25zb2xlIiwibWVzc2FnZXMiLCJyb2xlIiwiY29udGVudCIsInRleHQiLCJpbWFnZV91cmwiLCJ1cmwiLCJjb21wbGV0aW9uIiwiY2hhdCIsImNvbXBsZXRpb25zIiwiY3JlYXRlIiwibW9kZWwiLCJyZXNwb25zZV9mb3JtYXQiLCJyYXdDb250ZW50IiwiY2hvaWNlcyIsImxvZyIsIkpTT04iLCJwYXJzZSIsIkFycmF5IiwiaXNBcnJheSIsInRpdGxlQ2FuZGlkYXRlIiwidGl0bGUiLCJwZXJtaXRfdGl0bGUiLCJwZXJtaXROdW1iZXJDYW5kaWRhdGUiLCJwZXJtaXRfbnVtYmVyIiwibnVtYmVyIiwicGVybWl0TnVtYmVyIiwiZG9jdW1lbnRDYXRlZ29yeSIsImRvY3VtZW50X2NhdGVnb3J5IiwiY2F0ZWdvcnkiLCJzdGFydERhdGUiLCJzdGFydF9kYXRlIiwiaXNzdWVkX2RhdGUiLCJpc3N1ZV9kYXRlIiwiZW5kRGF0ZSIsImVuZF9kYXRlIiwiZXhwaXJhdGlvbl9kYXRlIiwiZXhwaXJ5X2RhdGUiLCJhdXRvUmVuZXciLCJhdXRvX3JlbmV3IiwianVyaXNkaWN0aW9uQ2FuZGlkYXRlIiwianVyaXNkaWN0aW9uIiwianVyaXNkaWN0aW9uTmFtZSIsImlzc3VpbmdBdXRob3JpdHlDYW5kaWRhdGUiLCJpc3N1aW5nX2F1dGhvcml0eSIsImlzc3VpbmdBdXRob3JpdHkiLCJyYXdGaWVsZHMiLCJzb3VyY2VGaWxlIiwib3B0aW9ucyIsImV4aXN0aW5nQnVja2V0IiwiZXhpc3RpbmdQYXRoIiwiZXhpc3RpbmdDb250ZW50VHlwZSIsImV4aXN0aW5nTmFtZSIsImV4aXN0aW5nU2l6ZSIsInN0YXJ0c1dpdGgiLCJub3JtYWxpemVkU2l6ZSIsInBhcnNlSW50IiwidW5kZWZpbmVkIiwiYnVja2V0IiwicGF0aCIsImNvbnRlbnRUeXBlIiwibGVuZ3RoIiwibmFtZSIsInNpemUiLCJpc0Zpbml0ZSIsImV4dGVuc2lvbiIsImluZmVyRXh0ZW5zaW9uIiwib2JqZWN0UGF0aCIsInVwbG9hZEVycm9yIiwic3RvcmFnZSIsInVwbG9hZCIsInVwc2VydCIsImZpbGVOYW1lIiwicGFydHMiLCJzcGxpdCIsImV4dCIsInBvcCIsImNvbnN0cnVjdG9yIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/permits/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/openai.ts":
/*!***********************!*\
  !*** ./lib/openai.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   openai: () => (/* binding */ openai)\n/* harmony export */ });\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! openai */ \"(rsc)/./node_modules/openai/index.mjs\");\n\nconst openai = new openai__WEBPACK_IMPORTED_MODULE_0__[\"default\"]({\n    apiKey: process.env.OPENAI_API_KEY\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvb3BlbmFpLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQTRCO0FBRXJCLE1BQU1DLFNBQVMsSUFBSUQsOENBQU1BLENBQUM7SUFDL0JFLFFBQVFDLFFBQVFDLEdBQUcsQ0FBQ0MsY0FBYztBQUNwQyxHQUFHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vbGliL29wZW5haS50cz8wMGQ4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBPcGVuQUkgZnJvbSBcIm9wZW5haVwiO1xuXG5leHBvcnQgY29uc3Qgb3BlbmFpID0gbmV3IE9wZW5BSSh7XG4gIGFwaUtleTogcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVksXG59KTtcbiJdLCJuYW1lcyI6WyJPcGVuQUkiLCJvcGVuYWkiLCJhcGlLZXkiLCJwcm9jZXNzIiwiZW52IiwiT1BFTkFJX0FQSV9LRVkiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/openai.ts\n");

/***/ }),

/***/ "(rsc)/./lib/storage.ts":
/*!************************!*\
  !*** ./lib/storage.ts ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   PERMIT_FILES_BUCKET: () => (/* binding */ PERMIT_FILES_BUCKET)\n/* harmony export */ });\nconst PERMIT_FILES_BUCKET = \"permit-files\";\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3RvcmFnZS50cyIsIm1hcHBpbmdzIjoiOzs7O0FBQU8sTUFBTUEsc0JBQXNCLGVBQXdCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vbGliL3N0b3JhZ2UudHM/NWRjOCJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3QgUEVSTUlUX0ZJTEVTX0JVQ0tFVCA9IFwicGVybWl0LWZpbGVzXCIgYXMgY29uc3Q7XG5cbmV4cG9ydCB0eXBlIFBlcm1pdFNvdXJjZUZpbGVNZXRhID0ge1xuICBidWNrZXQ6IHN0cmluZztcbiAgcGF0aDogc3RyaW5nO1xuICBjb250ZW50VHlwZTogc3RyaW5nO1xuICBuYW1lOiBzdHJpbmc7XG4gIHNpemU6IG51bWJlcjtcbn07XG4iXSwibmFtZXMiOlsiUEVSTUlUX0ZJTEVTX0JVQ0tFVCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/storage.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabase/server.ts":
/*!********************************!*\
  !*** ./lib/supabase/server.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createSupabaseServerClient: () => (/* binding */ createSupabaseServerClient)\n/* harmony export */ });\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n/* harmony import */ var _supabase_ssr__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/ssr */ \"(rsc)/./node_modules/@supabase/ssr/dist/module/index.js\");\n\n\nfunction createSupabaseServerClient() {\n    const cookieStore = (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.cookies)();\n    const supabaseUrl = \"https://qnroanyfrzekpjruykmp.supabase.co\";\n    const supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFucm9hbnlmcnpla3BqcnV5a21wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzNDM2NDcsImV4cCI6MjA3ODkxOTY0N30.RaiNCddEVVAVHYfTFtgISA16jRia2eGkFZqNknoluTk\";\n    if (!supabaseUrl || !supabaseAnonKey) {\n        throw new Error(\"Supabase server client is not configured. Set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY.\");\n    }\n    return (0,_supabase_ssr__WEBPACK_IMPORTED_MODULE_1__.createServerClient)(supabaseUrl, supabaseAnonKey, {\n        cookies: {\n            get (name) {\n                return cookieStore.get(name)?.value;\n            },\n            set (name, value, options) {\n                cookieStore.set({\n                    name,\n                    value,\n                    ...options\n                });\n            },\n            remove (name, options) {\n                cookieStore.delete({\n                    name,\n                    ...options\n                });\n            }\n        }\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3VwYWJhc2Uvc2VydmVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUF1QztBQUNZO0FBRTVDLFNBQVNFO0lBQ2QsTUFBTUMsY0FBY0gscURBQU9BO0lBQzNCLE1BQU1JLGNBQWNDLDBDQUFvQztJQUN4RCxNQUFNRyxrQkFBa0JILGtOQUF5QztJQUVqRSxJQUFJLENBQUNELGVBQWUsQ0FBQ0ksaUJBQWlCO1FBQ3BDLE1BQU0sSUFBSUUsTUFBTTtJQUNsQjtJQUVBLE9BQU9ULGlFQUFrQkEsQ0FBQ0csYUFBYUksaUJBQWlCO1FBQ3REUixTQUFTO1lBQ1BXLEtBQUlDLElBQVk7Z0JBQ2QsT0FBT1QsWUFBWVEsR0FBRyxDQUFDQyxPQUFPQztZQUNoQztZQUNBQyxLQUFJRixJQUFZLEVBQUVDLEtBQWEsRUFBRUUsT0FBOEM7Z0JBQzdFWixZQUFZVyxHQUFHLENBQUM7b0JBQUVGO29CQUFNQztvQkFBTyxHQUFHRSxPQUFPO2dCQUFDO1lBQzVDO1lBQ0FDLFFBQU9KLElBQVksRUFBRUcsT0FBOEM7Z0JBQ2pFWixZQUFZYyxNQUFNLENBQUM7b0JBQUVMO29CQUFNLEdBQUdHLE9BQU87Z0JBQUM7WUFDeEM7UUFDRjtJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9saWIvc3VwYWJhc2Uvc2VydmVyLnRzPzY2MjUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY29va2llcyB9IGZyb20gXCJuZXh0L2hlYWRlcnNcIjtcbmltcG9ydCB7IGNyZWF0ZVNlcnZlckNsaWVudCB9IGZyb20gXCJAc3VwYWJhc2Uvc3NyXCI7XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVTdXBhYmFzZVNlcnZlckNsaWVudCgpIHtcbiAgY29uc3QgY29va2llU3RvcmUgPSBjb29raWVzKCk7XG4gIGNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMO1xuICBjb25zdCBzdXBhYmFzZUFub25LZXkgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWTtcblxuICBpZiAoIXN1cGFiYXNlVXJsIHx8ICFzdXBhYmFzZUFub25LZXkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJTdXBhYmFzZSBzZXJ2ZXIgY2xpZW50IGlzIG5vdCBjb25maWd1cmVkLiBTZXQgTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIGFuZCBORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWS5cIik7XG4gIH1cblxuICByZXR1cm4gY3JlYXRlU2VydmVyQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZUFub25LZXksIHtcbiAgICBjb29raWVzOiB7XG4gICAgICBnZXQobmFtZTogc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiBjb29raWVTdG9yZS5nZXQobmFtZSk/LnZhbHVlO1xuICAgICAgfSxcbiAgICAgIHNldChuYW1lOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcsIG9wdGlvbnM6IFBhcmFtZXRlcnM8dHlwZW9mIGNvb2tpZVN0b3JlLnNldD5bMl0pIHtcbiAgICAgICAgY29va2llU3RvcmUuc2V0KHsgbmFtZSwgdmFsdWUsIC4uLm9wdGlvbnMgfSk7XG4gICAgICB9LFxuICAgICAgcmVtb3ZlKG5hbWU6IHN0cmluZywgb3B0aW9uczogUGFyYW1ldGVyczx0eXBlb2YgY29va2llU3RvcmUuc2V0PlsyXSkge1xuICAgICAgICBjb29raWVTdG9yZS5kZWxldGUoeyBuYW1lLCAuLi5vcHRpb25zIH0pO1xuICAgICAgfSxcbiAgICB9LFxuICB9KTtcbn1cbiJdLCJuYW1lcyI6WyJjb29raWVzIiwiY3JlYXRlU2VydmVyQ2xpZW50IiwiY3JlYXRlU3VwYWJhc2VTZXJ2ZXJDbGllbnQiLCJjb29raWVTdG9yZSIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlQW5vbktleSIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwiRXJyb3IiLCJnZXQiLCJuYW1lIiwidmFsdWUiLCJzZXQiLCJvcHRpb25zIiwicmVtb3ZlIiwiZGVsZXRlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabase/server.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabase/service.ts":
/*!*********************************!*\
  !*** ./lib/supabase/service.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createSupabaseServiceClient: () => (/* binding */ createSupabaseServiceClient)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n\nfunction createSupabaseServiceClient() {\n    const supabaseUrl = \"https://qnroanyfrzekpjruykmp.supabase.co\";\n    const serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n    if (!supabaseUrl || !serviceRoleKey) {\n        throw new Error(\"Supabase service client is not configured. Set NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY.\");\n    }\n    const isProbablyJwt = serviceRoleKey.split(\".\").length === 3;\n    if (!isProbablyJwt) {\n        throw new Error(\"SUPABASE_SERVICE_ROLE_KEY is not a valid JWT. Copy the `service_role` key from Supabase â†’ Settings â†’ API and paste it here (it should contain two periods).\");\n    }\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, serviceRoleKey, {\n        auth: {\n            persistSession: false\n        },\n        global: {\n            headers: {\n                \"X-Client-Info\": \"permit-buddy-admin\"\n            }\n        }\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3VwYWJhc2Uvc2VydmljZS50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUFxRDtBQUU5QyxTQUFTQztJQUNkLE1BQU1DLGNBQWNDLDBDQUFvQztJQUN4RCxNQUFNRyxpQkFBaUJILFFBQVFDLEdBQUcsQ0FBQ0cseUJBQXlCO0lBRTVELElBQUksQ0FBQ0wsZUFBZSxDQUFDSSxnQkFBZ0I7UUFDbkMsTUFBTSxJQUFJRSxNQUNSO0lBRUo7SUFFQSxNQUFNQyxnQkFBZ0JILGVBQWVJLEtBQUssQ0FBQyxLQUFLQyxNQUFNLEtBQUs7SUFFM0QsSUFBSSxDQUFDRixlQUFlO1FBQ2xCLE1BQU0sSUFBSUQsTUFDUjtJQUVKO0lBRUEsT0FBT1IsbUVBQVlBLENBQUNFLGFBQWFJLGdCQUFnQjtRQUMvQ00sTUFBTTtZQUNKQyxnQkFBZ0I7UUFDbEI7UUFDQUMsUUFBUTtZQUNOQyxTQUFTO2dCQUNQLGlCQUFpQjtZQUNuQjtRQUNGO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL2xpYi9zdXBhYmFzZS9zZXJ2aWNlLnRzPzA1ZmQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSBcIkBzdXBhYmFzZS9zdXBhYmFzZS1qc1wiO1xuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlU3VwYWJhc2VTZXJ2aWNlQ2xpZW50KCkge1xuICBjb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTDtcbiAgY29uc3Qgc2VydmljZVJvbGVLZXkgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZO1xuXG4gIGlmICghc3VwYWJhc2VVcmwgfHwgIXNlcnZpY2VSb2xlS2V5KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgXCJTdXBhYmFzZSBzZXJ2aWNlIGNsaWVudCBpcyBub3QgY29uZmlndXJlZC4gU2V0IE5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCBhbmQgU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWS5cIlxuICAgICk7XG4gIH1cblxuICBjb25zdCBpc1Byb2JhYmx5Snd0ID0gc2VydmljZVJvbGVLZXkuc3BsaXQoXCIuXCIpLmxlbmd0aCA9PT0gMztcblxuICBpZiAoIWlzUHJvYmFibHlKd3QpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBcIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkgaXMgbm90IGEgdmFsaWQgSldULiBDb3B5IHRoZSBgc2VydmljZV9yb2xlYCBrZXkgZnJvbSBTdXBhYmFzZSDihpIgU2V0dGluZ3Mg4oaSIEFQSSBhbmQgcGFzdGUgaXQgaGVyZSAoaXQgc2hvdWxkIGNvbnRhaW4gdHdvIHBlcmlvZHMpLlwiXG4gICAgKTtcbiAgfVxuXG4gIHJldHVybiBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHNlcnZpY2VSb2xlS2V5LCB7XG4gICAgYXV0aDoge1xuICAgICAgcGVyc2lzdFNlc3Npb246IGZhbHNlLFxuICAgIH0sXG4gICAgZ2xvYmFsOiB7XG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiWC1DbGllbnQtSW5mb1wiOiBcInBlcm1pdC1idWRkeS1hZG1pblwiLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcbn1cbiJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJjcmVhdGVTdXBhYmFzZVNlcnZpY2VDbGllbnQiLCJzdXBhYmFzZVVybCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJzZXJ2aWNlUm9sZUtleSIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJFcnJvciIsImlzUHJvYmFibHlKd3QiLCJzcGxpdCIsImxlbmd0aCIsImF1dGgiLCJwZXJzaXN0U2Vzc2lvbiIsImdsb2JhbCIsImhlYWRlcnMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabase/service.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@supabase","vendor-chunks/next","vendor-chunks/tslib","vendor-chunks/cookie","vendor-chunks/openai"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fpermits%2Froute&page=%2Fapi%2Fpermits%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fpermits%2Froute.ts&appDir=%2Fhome%2Fmav%2Fprojects%2Fpermit-buddy%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Fmav%2Fprojects%2Fpermit-buddy&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();